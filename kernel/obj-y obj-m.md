일반적인 Makefile과 달리 커널 Makefile은 이 `obj-y`와 `obj-m`이라는 특수한 변수들을 통해 무엇을 커널 본체에 포함하고, 무엇을 모듈로 만들지 결정합니다.

이 변수들은 단순히 이름만 정해진 것이 아니라, 커널 빌드 시스템이 소스 코드를 어떻게 처리할지 지시하는 **예약어** 같은 역할을 합니다.

---

## 1. obj-y (Built-in 객체)

`obj-y`의 **'y'** 는 **Yes** 를 의미합니다.

- **의미:** 이 변수에 지정된 목적 파일(`.o`)은 커널 이미지(**vmlinux**) 안에 정적으로 포함됩니다.
    
- **특징:** 시스템이 부팅될 때 항상 메모리에 올라와 있으며, 별도의 로드 과정 없이 즉시 사용할 수 있습니다. 커널의 핵심 기능이나 부팅 시 반드시 필요한 드라이버들이 여기에 해당합니다.
    
- **결과물:** 커널 실행 파일의 일부가 됩니다.
    

## 2. obj-m (Loadable Module 객체)

`obj-m`의 **'m'** 은 **Module**을 의미합니다.

- **의미:** 이 변수에 지정된 파일은 커널 본체에 포함되지 않고, 필요할 때만 불러올 수 있는 **동적 부하 모듈(`.ko`)** 로 빌드됩니다.
    
- **특징:** 커널 크기를 줄일 수 있고, `insmod`나 `modprobe` 명령어를 통해 운영체제 실행 중에 넣었다 뺐다 할 수 있습니다. 특정 하드웨어를 사용할 때만 필요한 드라이버 등에 사용됩니다.
    
- **결과물:** `.ko` (Kernel Object) 확장자를 가진 별도의 파일이 생성됩니다.
    

---

### 한눈에 비교하기

| **구분**    | **obj-y**        | **obj-m**      |
| --------- | ---------------- | -------------- |
| **의미**    | 커널 내장 (Built-in) | 커널 모듈 (Module) |
| **포함 위치** | `vmlinux` 이미지 내부 | 외부 `.ko` 파일    |
| **메모리**   | 상주 (항상 점유)       | 필요할 때만 점유      |
| **부팅 속도** | 초기화 속도가 빠름       | 모듈 로딩 시간이 필요함  |

---

## 3. 왜 이렇게 쓰나요? (Kconfig와의 연동)

실제 커널 소스를 보면 단순히 파일을 직접 적기보다 아래와 같이 **조건부 할당** 형식을 훨씬 많이 씁니다.

Makefile

```
# 예시: Kconfig 설정에 따라 y 혹은 m으로 결정됨
obj-$(CONFIG_EXT4_FS) += ext4.o
```

이 코드는 `make menuconfig` 같은 설정 화면에서 사용자가 무엇을 선택했느냐에 따라 마법처럼 동작합니다.

- 사용자가 EXT4를 **[ * ] (Built-in)**으로 선택하면: `obj-y += ext4.o` 가 됩니다.
    
- 사용자가 EXT4를 **[ M ] (Module)**로 선택하면: `obj-m += ext4.o` 가 됩니다.
    
- 사용자가 선택하지 않으면(**[ N ]**): `obj- += ext4.o` 가 되어 빌드에서 제외됩니다.
    

### 💡 팁: 하위 디렉토리 탐색

Kbuild는 `obj-y`나 `obj-m`에 디렉토리 이름이 오면, 해당 디렉토리 안으로 들어가서 또 다른 Makefile을 찾아 빌드를 이어갑니다.

Makefile

```
obj-y += drivers/  # drivers 디렉토리 내부를 빌드하라!
```

---

혹시 작성 중이신 드라이버를 **실제로 빌드하기 위한 가장 간단한 Makefile 예제**가 필요하신가요? 원하신다면 바로 코드를 짜 드릴 수 있습니다.